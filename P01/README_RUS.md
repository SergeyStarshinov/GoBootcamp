# Групповой проект Rogue Game

В данном командном проекте разработано консольное игровое roguelike-приложение на языке программирования Go в духе классической игры Rogue 1980 года разработки.

Мое участие в данном проекте: весь backend (модули application, data, domain), за исключением статистики и таблицы рекордов

## Общая информация

Игра начинается на самом верхнем ярусе не нанесенного на карту подземелья с большим количеством монстров и сокровищ. Постепенно по мере продвижения вглубь случайно сгенерированного подземелья, возрастает сила монстров и продвижение усложняется.

Всякий ярус подземелья состоит из сетки 3х3 комнаты и соединяющих их коридоров. Подземелье и расположение объектов в нем генерируется случайным образом. 

У игрока есть 3 характеристики: здоровье, физическая сила и ловкость. Все 3 характеристики можно увеличить с помощью различных предметов. 

### Архитектура приложения
Проект разделен на слои:
- Слой представления (front);
- Слой контроллера (application)
- Слой бизнес-логики (domain);
- Слой доступа к данным (data).

Так, в слое **front** размещен код, который организовывает отображение на экране пользователя и ввод пользовательских данных. 

В слое **application** размещен контроллер, обрабатывающий пользовательский ввод и запускающий соответствующие сценарии работы.

Слой **domain** отражает бизнес-логику приложения. В текущем проекте это определение логики сущностей, связанных с игрой — сама игра, игрок, противники, уровни, карта, предметы и другие, а также логика игрового процесса. 

Слой **data** отвечает за сохранение и загрузку игры.


## Сущности игры

Основные сущности с базовыми атрибутами:
- Игровая сессия;
- Уровень, содержащий информацию о комнатах и коридорах;
- Комната;
- Персонаж:
  + максимальный уровень здоровья,
  + здоровье,
  + ловкость,
  + сила,
  + текущее оружие;
- Рюкзак;
- Противник:
  + тип,
  + здоровье,
  + ловкость,
  + сила,
  + враждебность;
- Предмет:
  + тип,
  + здоровье (количество единиц повышения, для еды),
  + максимальный уровень здоровья (количество единиц повышения, для свитков и эликсиров, вместе с этим повышается и сам уровень здоровья),
  + ловкость (количество единиц повышения, для свитков и эликсиров),
  + сила (количество единиц повышения, для свитков, эликсиров и оружия),
  + стоимость (для сокровищ).

### Логика игры
- Игра должна содержит 21 уровень с подземельями.
- Каждый уровень подземелья состоит из 9 комнат, соединенных коридорами, из любой комнаты по этим коридорам можно попасть в любую другую. Лабиринт разделен дверями, для прохождения через которые нужны ключи соответствующего цвета. В игре реализовано два типа ключей и дверей, красные и синие.
- Туман войны:
  + Неизведанные комнаты и коридоры не отображаются.
  + Просмотренные комнаты, но в которых не находится игрок, отображаются только как стены.
  + В комнате, в которой находится игрок, отображаются стены, пол, акторы и предметы.
  + При нахождении в непосредственной близости с комнатой со стороны коридора туман войны рассеивается на области прямой видимости.
- В каждой комнате могут находиться противники и предметы, за исключением стартовой комнаты.
- Игрок управляет перемещением персонажа, может взаимодействовать с предметами и сражаться с противниками.
- Цель игрока — найти на каждом уровне переход на следующий уровень и, таким образом, пройти 21 уровень.
- На каждом уровне игрок начинает в случайной позиции стартовой комнаты, где гарантированно отсутствуют противники.
- После смерти главного героя игра заканчивается.
- С каждым новым уровнем повышается количество и сложность противников, снижается количество полезных предметов и повышается количество сокровищ, которые выпадают с побежденных противников.
- После любого прохождения (успешного и нет) результат игрока фиксируется в таблицу рекордов, где указывается достигнутый уровень подземелья и количество собранных сокровищ. Таблица рекордов сортируется по количеству сокровищ.
- Вся игра работает в пошаговом режиме, пока игрок не сделал ход, весь мир стоит в ожидании.

### Логика персонажа
- Характеристика здоровья персонажа показывает его текущий уровень здоровья, и когда здоровье персонажа достигает 0 или становится меньше 0, игра заканчивается поражением игрока.
- Характеристика максимального уровня здоровья показывает максимальный уровень здоровья персонажа, который может быть восстановлен путем употребления еды.
- Характеристика ловкости участвует в формуле вычисления вероятности попадания противников по персонажу и персонажа по противникам.
- Характеристика силы Влияет на наносимый персонажем урон.
- За победу над противником персонаж получает количество сокровищ, зависящее от сложности противника.
- Персонаж может поднимать предметы и складывать в свой рюкзак, а затем использовать их. Размер рюкзака ограничен.
- Каждый предмет при использовании может временно или постоянно изменять одну из характеристик персонажа.
- Достигнув выхода из уровня, персонаж автоматически попадает на следующий уровень.

### Логика противников
- Каждый противник имеет аналогичные игроку характеристики здоровья, ловкости и силы, дополнительно к этому имеет характеристику враждебности.
- Характеристика враждебности определяет расстояние, с которого противник начинает преследовать игрока.
- 5 видов противников: 
  + Зомби (отображение: зеленый z): низкая ловкость; средняя сила, враждебность; высокое здоровье. 
  + Вампир (отображение: красная v): высокая ловкость, враждебность и здоровье; средняя сила. Отнимает некоторое количество максимального уровня здоровья игроку при успешной атаке. Первый удар по вампиру — всегда промах. 
  + Привидение (отображение: белый g): высокая ловкость; низкая сила, враждебность и здоровье. Постоянно телепортируется по комнате и периодически становится невидимым, пока игрок не вступил в бой. 
  + Огр (отображение: желтый O): ходит по комнате на две клетки. Очень высокая сила и здоровье, но после каждой атаки отдыхает один ход, затем гарантированно контратакует; низкая ловкость; средняя враждебность.
  + Змей-маг (отображение: белая s): очень высокая ловкость. Ходит по карте по диагонали, постоянно меняя сторону. У каждой успешной атаки есть вероятность «усыпить» игрока на один ход. Высокая враждебность.
  + Мимик (белая M), который имитирует предметы. Высокая ловкость, низкая сила, высокое здоровье и низкая враждебность. 
- Каждый тип противников имеет свой паттерн для передвижения по комнате.
- Когда начинается преследование игрока, все монстры двигаются по одному паттерну, кратчайшим путем по соседним клеткам в сторону игрока.
- Если игрок находится в области, когда монстр должен начать его преследовать, но при этом не существует пути к нему, то монстр продолжает двигаться случайным образом по своему паттерну.

### Логика окружения
- Каждый тип предмета имеет свое значение:
  + сокровища (имеют стоимость, накапливаются и влияют на итоговый рейтинг, можно получить только при победе над монстром);
  + еда (восстанавливает здоровье на некоторую величину);
  + эликсиры (временно повышают одну из характеристик: ловкость, силу, максимальное здоровье);
  + свитки (постоянно повышают одну из характеристик: ловкость, силу, максимальное здоровье);
  + оружие (имеют характеристику силы, при использовании оружия меняется формула вычисления наносимого урона).
- При повышении максимального уровня здоровья сама величина здоровья увеличивается на ту же величину.
- Если после окончания действия эликсира здоровье становится равным 0 или ниже 0, здоровье игрока становится равным 1.
- Рюкзак хранит в себе все типы предметов.
- Когда персонаж наступает на предмет, он автоматически добавляется в рюкзак, если он неполон (в рюкзаке может храниться максимум 9 предметов каждого типа, сокровища копятся и хранятся в единственной ячейке).
- Еда, эликсиры, свитки при использовании тратятся.
- Оружие при смене падает на пол на случайную соседнюю клетку.

### Логика боя
- Бой вычисляется в пошаговом режиме.
- Атака производится путем перемещения персонажа по направлению к противнику.
- Инициация боя происходит при контакте с врагом.
- Удары просчитываются по очереди, в несколько этапов: 
  + 1 этап расчета удара — проверка на попадание. Проверка на попадание случайна и высчитывается из ловкости бьющего и цели удара.
  + 2 этап — расчет урона. Рассчитывается из силы и модификаторов (оружия).
  + 3 этап — применение урона. Урон вычитается из здоровья. Если здоровье падает до 0 или ниже, то противник или персонаж погибает.
- Из каждого противника при победе выпадает случайное количество сокровищ, зависящее от враждебности, силы и ловкости противника.

### Управление
- Управление персонажем:
  + Передвижение при помощи клавиш WASD.
  + Применение оружия из рюкзака при помощи кнопки h.
  + Применение еды из рюкзака при помощи кнопки j.
  + Применение эликсира из рюкзака при помощи кнопки k.
  + Применение свитка из рюкзака при помощи e.

### Статистика
- В игре собирается и отображается в отдельном представлении статистика прохождений, отсортированная по количеству набранных сокровищ: количество сокровищ, достигнутый уровень, количество побежденных противников, количество съеденной еды, количество выпитых эликсиров, количество прочитанных свитков, количество нанесенных и пропущенных ударов, количество пройденных клеток.

## Сохранение игры
Сохранение об игровом прогрессе игрока производится в файл ``json``.


## Баланс
- Реализована автоматическая подстройка сложности игры под текущее прохождение игры. Если игрок легко проходит уровни, сложность увеличивается: увеличивается количество монстров и их характеристики, уменьшается количество полезных предметов. Если игрок сталкивается с трудностями, то количество предметов увеличивается, количество и сложность врагов уменьшаются.
